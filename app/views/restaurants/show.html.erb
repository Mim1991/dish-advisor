<h1 class="text-center"><%= @restaurant.name %> </h1>

<div class="restaurant-dish-grid">
  <% @restaurant.dishes.each do |dish| %>
  <div class="dish-card" id="<%= dish.name.parameterize %>">
    <div class="dish-name">
      <h2><%= dish.name %></h2>
    </div>
    <div class="dish-allergen">
      <p><%= dish.allergen %></p>
    </div>
    <div class="dish-description">
      <p><%= dish.description %></p>
    </div>
    <div class="dish-average-rating">
      <% sum = 0.0 %>
      <% dish.reviews.each do |review| %>
        <% sum += review.rating %>
        <% sum %>
      <% end %>
      <% if sum >= 1 %>
        <% average =  (sum / dish.reviews.count) %>
        <%= average.round(1) %>
      <% else %>
        <p>No Ratings yet!</p>
      <% end %>
    </div>
    <div class="dish-rating-icons-size">
      <p id="rating-margin"><%="üç¥" * average.to_f.round()%></p>
    </div>
    <div class="dish-review-link">
        <%= link_to "Add review", new_dish_review_path(dish) %>
    </div>
    <!-- Modal -->
    <div class="screen-overlay">
    </div>
      <div class="modal-box-total modal-box-border">
        <div class="modal-box">

          <div class="rating-overview text-center">
            <div class="close-modal">
              <h1>X</h1>
            </div>
            <h5 class="dish-name-popup"><%= dish.name.upcase %></h5>
            <p class="dish-description-popup"><%= dish.description %></p>
          </div>
          <div class="rating-content-scores">
            <% if dish.reviews.count == 0  %>
              <h5>No Reviews Yet!</h5>
            <% else %>
            <div class="review-heading">
              <h5>REVIEWS (<span id="review-count-select"><%= dish.reviews.count %></span>)</h5>
            </div>
            <div class="stars-container">
              <div class="number-stars">
                <p>5 üç¥</p>
                <div class="bar-container">
                  <div class="bar-colour" id="five-colour"></div>
                </div>
                <div class="rating-count-star">
                  <% five_array = [] %>
                  <% dish.reviews.each do |review|  %>
                    <% if review.rating == 5  %>
                      <% five_array << review %>
                    <% end %>
                  <% end %>
                  <%= five_array.count %>
                </div>
              </div>
              <div class="number-stars">
                <p>4 üç¥</p>
                <div class="bar-container">
                  <div class="bar-colour" id="four-colour"></div>
                </div>
                <div class="rating-count-star">
                  <% four_array = [] %>
                  <% dish.reviews.each do |review|  %>
                    <% if review.rating == 4  %>
                      <% four_array << review %>
                    <% end %>
                  <% end %>
                  <%= four_array.count %>
                </div>
              </div>
              <div class="number-stars">
                <p>3 üç¥</p>
                <div class="bar-container">
                  <div class="bar-colour" id="three-colour"></div>
                </div>
                <div class="rating-count-star">
                  <% three_array = [] %>
                  <% dish.reviews.each do |review|  %>
                    <% if review.rating == 3  %>
                      <% three_array << review %>
                    <% end %>
                  <% end %>
                  <%= three_array.count %>
                </div>
              </div>
              <div class="number-stars">
                <p>2 üç¥</p>
                <div class="bar-container">
                  <div class="bar-colour" id="two-colour"></div>
                </div>
                <div class="rating-count-star">
                  <% two_array = [] %>
                  <% dish.reviews.each do |review|  %>
                    <% if review.rating == 2  %>
                      <% two_array << review %>
                    <% end %>
                  <% end %>
                  <%= two_array.count %>
                </div>
              </div>
              <div class="number-stars">
                <p>1 üç¥</p>
                <div class="bar-container">
                  <div class="bar-colour" id="one-colour"></div>
                </div>
                <div class="rating-count-star">
                  <% one_array = [] %>
                  <% dish.reviews.each do |review|  %>
                    <% if review.rating == 1  %>
                      <% one_array << review %>
                    <% end %>
                  <% end %>
                  <%= one_array.count %>
                </div>
              </div>
            </div>
          <% end %>
          </div>

          <div class="review-list">
            <% dish.reviews.reverse.each do |review| %>
              <div class="individual-review">
              <div class="review-user">
                <div class="title-positioning">
                  <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar"%>
                  <p class="review-name"><%= review.user.first_name.upcase %> <%= review.user.last_name.upcase %></p>
                </div>
                <p class="review-nationality"><%= review.user.nationality.upcase %></p>
              </div>
              <div class="review-body">
                <div class="star-visit">
                  <p class="review-rating"><%= "üç¥" * review.rating.to_i %></p>
                  <% if ((Date.today - review.visit_date).to_i) == 1 %>
                    <p class="date-since-visit"><%= (Date.today - review.visit_date).to_i %> day since visit </p>
                  <% elsif ((Date.today - review.visit_date).to_i / 7) < 1 %>
                    <p class="date-since-visit"><%= (Date.today - review.visit_date).to_i %> days since visit </p>
                  <% else %>
                    <p class="date-since-visit"><%= (Date.today - review.visit_date).to_i / 7 %> weeks since visit </p>
                  <% end %>
                </div>
                <p class="review-title"><%= review.title%></p>
                <p class="review-content"><%= review.content %></p>
                <p class="review-visit"><span>Review Date -  </span> <%= review.created_at.strftime("%b %d, %Y") %></p>
              </div>
            </div>
            <% end %>
          </div>
          <div class="margin-bottom-pad"></div>

          <div class="fave-button">
            <% dish_array = [] %>
            <% @favourite_dishes.each do |favourite| %>
              <% dish_array << favourite.dish.id %>
            <% end %>
            <% if dish_array.include? dish.id %>
              <p class="black">ADDED TO FAVOURITES</p>

            <% else %>
              <%= link_to "FAVOURITE", dish_favourites_path(dish), class: "link-select" ,method: :post, remote:true %>
            <% end %>
          </div>
        </div>
      </div>

  <!-- end of modal -->
  </div>
  <% end %>
</div>




